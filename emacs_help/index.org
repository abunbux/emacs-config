# -*- mode: org; -*-
#+TITLE: index
#+DESCRIPTION:
#+KEYWORDS:
#+AUTHOR:
#+email:
#+INFOJS_OPT:
#+STARTUP:  content

#+DATE: CREATED: <Sat Feb 04 20:56:00 MSK 2023>
# Time-stamp: <Последнее обновление -- Saturday February 4 20:59:57 MSK 2023>



** Небольшая справочная система

   Далее следует небольшое описание моих настроек, биндингов и некоторой специфики в работе с ~emacs~.
   В принципе, пишу эту справку для себя, ибо память не вечна и не бесконечна, а моя так уж тем
   более. Но буду рад любому путнику, забредшему сюда, который если и не почерпнёт для себя кое-что
   полезное, так хоть посмеётся с моих попыток описать свои действия.

*** Ключевые обозначения

    | Key       | Name      | Modern Keyboard Equivalence |
    |-----------+-----------+-----------------------------|
    | M         | Meta      | Alt                         |
    | C         | Control   | Ctrl                        |
    | S         | Shift     | Shift                       |
    | SPC       | Space     | Space                       |
    | ESC       | Escape    | Escape (C-[)                |
    | PgUp      | prior     | PgUp                        |
    | PgDn      | next      | PgDn                        |
    | backspace | backspace | backspace                   |
    | s (*)     | super     | win                         |
    |           |           |                             |

    - Клавиша ~super~, как правило, располагается в левом нижнем углу рядом с клавишей ~Alt~, на ней
      обычно нарисован логотип ~Windows~.

*** Ключевые префиксы

    | Prefix Key | Purpose                                                           |
    |------------+-------------------------------------------------------------------|
    | C-x        | Префикс для большинства основных команд.                          |
    | C-h (<f1>) | Префикс для команд справки.                                       |
    | C-c    (*) | Этот префикс зарезервирован для пользователей и основных режимов. |
    | M-x        | Зарезервировано для выполнения команд Emacs (~M-x <cmd>~).          |
    | C-g        | Отмена любой команды.                                             |
    |            |                                                                   |


**** TODO @todo И немного о моих личных префиксах:

     |               |             | было ранее          |
     |---------------+-------------+---------------------|
     | C-z           |             | suspend-emacs       |
     | C-d           | kill/delete | delete-char         |
     | M-s           |             |                     |
     | M-h           |             |                     |
     | M-m           |             | back-to-indentation |
     | s (super) (*) |             |                     |
     |               |             |                     |

*** Мнемоника для запоминания некоторых принципов назначения клавиш в emacs

    | Letter | Mnemonic  |
    |--------+-----------|
    | p      | previous  |
    | n      | next      |
    | b      | backward  |
    | f      | forward   |
    | a      | beginning |
    | e      | end       |

*** TODO @todo Проверить и изучить следующие ссылки:

    - [[http://ergoemacs.org/emacs/emacs_kb_shortcuts_pain.html][Why Emacs's Keyboard Shortcuts are Painful]]
    - [[http://ergoemacs.org/emacs/command-frequency.html][Emacs's Command Frequency Statistics]]
    - [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Changing-Key-Bindings.html][Emacs Manual - 21.12 Changing Key Bindings]]
    - [[http://stackoverflow.com/questions/1144424/are-there-any-emacs-key-combinations-reserved-for-custom-commands][Are there any emacs key combinations reserved for custom commands?]]
    - [[https://www.masteringemacs.org/article/mastering-key-bindings-emacs][Mastering Key Bindings in Emacs]]

*** Выход из программы

    Как видно из нижеследующей таблички основная команда для выхода ~C-x C-c~
    (~save-buffers-kill-terminal~), может кто из особо продвинутых юзверей использует что-то другое,
    но я, мне кажется, ни разу ничем другим не воспользовался, ~C-z~ тоже довольно большая редкость в
    моей практике.

    | Key Binding       | Command (M-x <cmd>)        | Description                                   |
    |-------------------+----------------------------+-----------------------------------------------|
    |                   | kill-emacs                 | End Emacs and save all buffers automatically. |
    |                   | save-buffers-kill-emacs    | Ask to kill each buffer and close Emacs.      |
    | C-x C-c           | save-buffers-kill-terminal | Closes Emacs and asks to save each buffers.   |
    | C-z (*) (C-x C-z) | suspend-emacs              | Iconify Emacs in graphical mode or            |
    |                   |                            | suspend Emacs process when in terminal.       |
    |                   |                            |                                               |

    - ~C-z~, ~C-x~, ~C-c~ при включённом ~cua-mode~ на выход не работают.
    - ~C-z~ (~suspend-emacs~) забрал себе на префикс - ~C-x C-z~ делает то же самое.

    Также есть команды для того, чтобы «прибить» буфер(ы) - смотрим ниже.

*** Файлы, буфера, окна

    - (*) одной звёздочкой отмечены комбинации клавиш, которые после установки дополнительных модов
      стали выполнять те же функции, что и родные команды emacs, но с дополнительнм функционалом,
      тогда рядом указана команда, бывшая ранее, либо комбинацию назначил я на функцию из нового
      мода, на свои функции, или на усовершенствованные родные (defadvice).

    - (**) двумя звёздочками обозначены команды, ранее не имевшие назначенных комбинаций
      (биндингов).

      В любом случае читайте примечания, иногда там есть кое-что полезное.

    | Key Binding | Command (M-x <cmd>) | Description                                |
    |-------------+---------------------+--------------------------------------------|
    | C-x C-f     | find-file           | Open a new file or a existing file.        |
    | C-x C-v     | find-alternate-file | Open another file and kill current buffer. |
    | C-x C-s     | save-buffer         | Save Current Buffer.                       |
    | C-x C-w     | write-file          | Save Buffer as different file.             |
    | C-x s       | save-some-buffers   | Save all buffers interactively.            |
    | C-u C-x s   |                     | Save all buffers.                          |
    |             |                     |                                            |


    | Key Binding     | Command (M-x <cmd>)                | Description      |
    |-----------------+------------------------------------+------------------|
    | C-x [right key] | next-buffer                        |                  |
    | C-x [left key]  | previous-buffer                    |                  |
    | C-x 4 C-o       | display-buffer                     |                  |
    | C-x 6 b         | 2C-associate-buffer                |                  |
    | C-x 4 c         | clone-indirect-buffer-other-window |                  |
    | <f5>      (**)  | revert-buffer                      | Update a buffer. |
    |                 |                                    |                  |


    | Key Binding         | Command (M-x <cmd>)            | было ранее                    |
    |---------------------+--------------------------------+-------------------------------|
    | C-c b           (*) | counsel-ibuffer                |                               |
    | C-x b           (*) | ivy-switch-buffer              | ~switch-to-buffer~              |
    | C-x B (C-x 4 b) (*) | ivy-switch-buffer-other-window | ~switch-to-buffer-other-window~ |
    | C-x C-b         (*) | helm-mini                      | ~list-buffers~                  |
    |                     | view-buffer-other-frame        |                               |
    |                     |                                |                               |


    | *Kill or Delete*   | Command (M-x <cmd>)           |                                             |
    |------------------+-------------------------------+---------------------------------------------|
    | C-x k            | kill-buffer                   |                                             |
    | M-0       (**)   | kill-this-buffer              | команда родная, биндинг мой                 |
    | C-d 1     (**)   | kill-this-buffer              | делает то же самое, но некоторые            |
    |                  |                               | сочетания клавиш не работают в терминале.   |
    |                  |                               |                                             |
    |                  |                               |                                             |
    | C-d a     (*)    | my/kill-all-buffers           | убить все буфера.                           |
    | C-d o     (*)    | my/kill-other-buffers         | убить все буфера кроме текущего.            |
    | C-d - 0   (*)    | my/delete-current-buffer-file | удалить отображаемый в буфере файл с диска. |
    | C-x 4 0          | kill-buffer-and-window        |                                             |
    |                  |                               |                                             |
    | *menu*             |                               |                                             |
    |------------------+-------------------------------+---------------------------------------------|
    | C-<f10>          | buffer-menu-open              | see note                                    |
    | C-<down-mouse-1> | mouse-buffer-menu             |                                             |
    |                  |                               |                                             |

    - комбинация =C-<f10>= (=buffer-menu-open=) в kde-plasma не работает, так-как на неё назначено
      системное действие kwin - =Показать все окна со всех рабочих столов=. Я не стал заморачиваться
      переделывать.

      | Key Binding | Command (M-x <cmd>) | Description                                               |
      |-------------+---------------------+-----------------------------------------------------------|
      | C-x 0       | delete-window       | Delete Current Window                                     |
      | C-x 1       | delete-other-window | Keep the current window and delete the remaining windows. |
      | C-x 2       | split-window-below  | Split Horizontally                                        |
      | C-x 3       |                     | Split Vertically                                          |
      | C-x o       |                     | Switch Window                                             |
      |             |                     |                                                           |

*** Frames

    | Key Binding    | Command (M-x <cmd>)             | Description                                 |
    |----------------+---------------------------------+---------------------------------------------|
    | C-x 5 0        | kill-buffer                     | Close current frame                         |
    | C-x 5 1        | delete-other-frames             | Close all frames except current one         |
    | C-x 5 2        | make-frame-command              | Create a new frame                          |
    | C-x 5 o        | other-frame                     | Alternate frame                             |
    | C-z or C-x C-z | iconify-or-deiconify-frame      | Minimize current frame                      |
    | C-x 5 f        | find-file-other-frame           | Open file in a new frame.                   |
    | C-x 5 r        | find-file-read-only-other-frame | Open file in a new frame in read-only mode. |
    | C-x 5 b        | switch-to-buffer-other-frame    | Switch to buffer in a new frame.            |
    | C-x 5 C-o      | display-buffer-other-frame      |                                             |
    |                |                                 |                                             |

    - The key bind C-z is overridden by cua-mode if it enabled.
    - In terminal the key binding C-x C-z or the command =M-x iconify-or-deiconify-frame= suspends
      the Emacs process. To return to the process: type in the Unix shell fg and return.

*** Поиск, замена, регулярные выражения

    Эти комбинации клавиш работают в дефолтном emacs, без дополнительных настроек:

    |       | *поиск в тексте*                                                          |
    |-------+-------------------------------------------------------------------------|
    | C-s   | Forward Search                                                          |
    | C-s   | Jump to next occurrence (в режиме поиска)                               |
    | C-r   | Backward Search                                                         |
    | C-r   | Jump to previour occurrence (в режиме поиска)                           |
    | M-%   | Replace                                                                 |
    | M-s . | Find Symbol under cursor                                                |
    | M-s w | Find Symbol under cursor, match symbols with underscore, dot, hyphen .. |
    | M-s o | List all matching lines                                                 |
    |       |                                                                         |

    |                    |                                                         |
    |--------------------+---------------------------------------------------------|
    | M-x replace-string | Batch replace string in selected region or  buffer.     |
    | M-x replace-regexp | Batch replace regex pattern in selected text or buffer. |
    | M-x regexp-builder | Build and test Emacs regex patterns.                    |

    Следует понимать, что даже после дополнительных настроек доступ к этим командам остаётся по
    комбинации ~M-x~.

    Далее описаны функции поиска, замены и работы с регулярными выражениями при дополнительных
    настройках.

    | Command             | Description                                                    |
    |---------------------+----------------------------------------------------------------|
    | M-x find-name-dired | Find all files with given grep match.                          |
    |                     |                                                                |
    | M-x find-grep-dired | Find all file names matching a shell wildcard pattern.         |
    |                     |                                                                |
    | M-x find-dired      | Find all file names with find arguments specified by the user. |
    |                     |                                                                |
    | M-x rgrep           | Search files that contains some regular expression.            |
    |                     | Needs grep and find installed.                                 |
    |                     |                                                                |
    | M-x lgrep           | Search for files matching a regular expression in a            |
    |                     | given directory without enter in subdirectories like rgrep.    |
    |                     |                                                                |
    | M-x locate          | Search files using the mlocate app or locate database.         |
    |                     | Needs locate installed.                                        |
    |                     |                                                                |



    |         | стало нынче                        | было ранее                      |   |
    |---------+------------------------------------+---------------------------------+---|
    | C-s     | counsel-grep-or-swiper             | isearch-forward                 |   |
    | C-r     | swiper-helm                        | isearch-backward                |   |
    | C-M-r   |                                    | isearch-backward-regexp         |   |
    | C-M-s   |                                    | isearch-forward-regexp          |   |
    |         |                                    |                                 |   |
    |         |                                    |                                 |   |
    | M-s C-s | vr/isearch-forward                 |                                 |   |
    | M-s C-r | vr/isearch-backward                |                                 |   |
    | M-%     | vr/query-replace                   | query-replace                   |   |
    | C-M-%   | vr/replace                         | query-replace-regexp            |   |
    | M-s M-% | my/vr/query-replace-from-beginning |                                 |   |
    | M-s w   |                                    | isearch-forward-word            |   |
    | M-s .   |                                    | isearch-forward-symbol-at-point |   |
    | M-s _   |                                    | isearch-forward-symbol          |   |
    |         |                                    |                                 |   |
    |         |                                    |                                 |   |
    |         |                                    |                                 |   |
    | M-s a a | ag                                 |                                 |   |
    |         |                                    |                                 |   |
    | M-s d a | helm-do-ag                         |                                 |   |
    | M-s d i | my/helm-do-ag-inverse              |                                 |   |
    | M-s a h | helm-ag                            |                                 |   |
    | M-s a d | ag-dired                           |                                 |   |
    | M-s a r | ag-regexp                          |                                 |   |
    | M-s a c | counsel-ag                         |                                 |   |
    |         |                                    |                                 |   |
    | M-s f f | helm-find                          |                                 |   |
    | M-s s r | counsel-rg                         |                                 |   |
    |         |                                    |                                 |   |



    helm-swoop (M-s s s)
    helm-multi-swoop-all (M-s s A)
    helm-multi-swoop (M-s s M)


    xah-list-matching-lines-no-regex (M-s s x)


    ag-files (M-s a f)
    helm-do-grep-ag (M-s g a)

    keep-lines (M-s C-k)
    flush-lines (M-s C-f)


    find-dired (M-s s d)

    swiper-all (M-s s c)
    helm-locate (M-s f l)
    helm-do-ag-buffers (M-s d b)
    helm-do-ag-this-file (M-s d f)


    |           |                           | было ранее |
    |-----------+---------------------------+------------|
    | M-s s O   | occur                     | M-s o      |
    | M-s s i   | my/invert-occur           |            |
    | M-s s RET | my/highlight-symbol-occur |            |
    | M-s s o   | helm-occur                |            |
    |           |                           |            |


    Команды в буфере swiper

    |   |   |   |   |
    |---+---+---+---|
    |   |   |   |   |
    |   |   |   |   |
    |   |   |   |   |


    ~swiper~ - поиск символа или слова в точке:
    - ~M-n~ - ~ivy-next-history-element~ - получить символ в точке.
    - ~M-j~ - ~ivy-yank-word~ - расширить ввод минибуфера следующим словом (аналогично ~C-s~ ~C-w~ в
      ~isearch~).
    - ~M-o w~   скопировать линию и вернуться в исходную точку:




    Команды в буфере helm

    |   |   |   |   |
    |---+---+---+---|
    |   |   |   |   |
    |   |   |   |   |
    |   |   |   |   |

**** grep

     перечислит весь совпадающий текст всех файлов в текущем каталоге. Если в настройках не указано -
     рекурсивно не ищет. Для этого в командной строке добавляем -r и имеем следующий вид grep -ir -nH
     -e "bind" *el. Хотя для рекурсивного поиска лучше использовать ~ag~ и ~rg~.

**** rgrep

     искать совпадающий текст во всех файлах в текущем каталоге и подкаталогах

**** lgrep

     искать только некоторые файлы текущего каталога, используя текстовый шаблон (регулярное
     выражение) в именах файлов в первую очередь.

**** grep-find

     комбинация команд ~grep~ и ~find.~
     Example prompt:
     ~find . -type f -print0 | xargs -0 -e grep -nH -e MySearchStr~

**** find-dired

     самая общая команда в этой серии, которая позволяет вам указать любое условие, которое можно
     проверить с помощью ~find~. Она принимает два аргумента минибуфера, каталог и аргументы поиска; она
     запускает поиск в каталоге, передавая ~find-args~, чтобы сказать, какое условие проверить. Чтобы
     использовать эту команду, вам нужно знать, как использовать ~find~.

**** find-name-dired

     читает аргументы ~directory~ и ~pattern~, и выбирает все файлы в каталоге или его подкаталогах, чьи
     индивидуальные имена соответствуют шаблону. Выбранные таким образом файлы отображаются в буфере
     ~Dired~, в котором доступны обычные команды ~Dired~.

*** Редактирование текста →

    |                  |                            |                                                  | was earlier   |
    |------------------+----------------------------+--------------------------------------------------+---------------|
    | backspace        | delete-char                |                                                  |               |
    | delete           | delete-backward-char       |                                                  |               |
    | M-d              | kill-word (forward)        | смотри примечание                                |               |
    | C-DEL            | kill-word (forward)        | смотри примечание                                |               |
    | C-backspace      | backward-kill-word         |                                                  |               |
    | C-x backspace    | backward-kill-sentence     |                                                  |               |
    |                  | kill-paragraph             |                                                  |               |
    |                  | backward-kill-paragraph    |                                                  |               |
    | C-k              | kill-line                  | From point to end of line                        |               |
    | M-k       (*)    | kill-sentence              | смотри примечание                                |               |
    | C-S-backspace    | kill-whole-line            |                                                  |               |
    | C-w       (*)    | kill-region                |                                                  |               |
    | M-w       (*)    | kill-ring-save             |                                                  |               |
    | C-y              | yank (paste)               |                                                  |               |
    | M-y       (*)    | helm-show-kill-ring        |                                                  | ~yank-pop~      |
    | C-x i            | insert-file                | Insert the content of a file at cursor position. |               |
    | C-M-\     (*)    | ~my/indent-region-or-buffer~ |                                                  | ~indent-region~ |
    | C-x TAB          | ident-rigidly              | Select a region and type C-x TAB.                |               |
    |                  |                            | Type right, left (move 1 space) or               |               |
    |                  |                            | S-right, S-left (move 1 tab) to move the block   |               |
    |                  |                            | to left or right.                                |               |
    |                  |                            | *Doesn't work if cua-mode is activated*.           |               |
    |                  |                            |                                                  |               |
    | C-q              | quoted-insert              |                                                  |               |
    | C-x r k          | kill-rectangle             |                                                  |               |
    | C-x r M-w        | copy-rectangle-as-kill     |                                                  |               |
    | C-_ (C-/, C-x u) | undo                       |                                                  |               |
    | C-SPC            | set-mark-command           | Begin Selection                                  |               |
    | C-x h            | mark-whole-buffer          | Select the whole buffer                          |               |
    | C-x 8 RET        | insert-char                |                                                  |               |
    | C-x C-q          | read-only-mode             | Toggle read-only mode.                           |               |
    | C-x C-o          | delete-blank-lines         | Delete all empty line around the cursor.         |               |
    | M-q              | fill-paragraph             | Justify / Re-align current paragraph             |               |
    |                  |                            |                                                  |               |
    | M-s C-e   (**)   | xah-clean-empty-lines      |                                                  |               |
    |                  |                            |                                                  |               |

    - ~M-s C-e~ (~xah-clean-empty-lines~) удаляет все пустые строки, заменяя их только одной. Работает
      во всём буфере или в выделенном регионе.

    - ~M-d~ или ~C-DEL~ (~kill-word~ (forward)) две комбинации на одну команду, можно назначить на
      что-нибудь другое;

    - ~M-k~ (~kill-sentence~) - ранее эта комбинация была переназначена на свою функцию по удалению
      строки, но затем я обнаружил сочетание ~C-S-backspace~ (~kill-whole-line~), функция была
      удалена, но клавиши решил оставить себе про запас.

    - ~kill-region~ (~C-w~) (~defadvice~) при отсутствии выделения вырезает всю линию, помещает её
      в ~kill-ring~, но, в отличие от ~my/delete-line~, остаётся на пустой
      строке, при существующем выделении ведёт себя как обычно.

      - ~kill-ring-save~ (~M-w~) (~defadvice~) при отсутствии выделения копирует всю линию, помещает её
      в ~kill-ring~, при существующем выделении ведёт себя как обычно.


    | *case*    |                 |                                                |
    |---------+-----------------+------------------------------------------------|
    | M-u (*) | upcase-word     | Make word uppercase                            |
    | M-l (*) | downcase-word   | Make word lowercase                            |
    | M-c (*) | capitalize-word | Make word title (Capitalize only first letter) |
    |         |                 |                                                |

    - при существующем выделении все три команды выполняют операцию с выделением.


    | *comment*   |                              |                                  |
    |-----------+------------------------------+----------------------------------|
    | M-;       | comment-dwim                 | Comment/ Uncomment Selected Code |
    |           | comment-kill                 |                                  |
    | C-x C-;   | comment-line                 |                                  |
    |           | comment-indent               |                                  |
    |           | comment-region               |                                  |
    |           | uncomment-region             |                                  |
    |           | comment-or-uncomment-region  |                                  |
    | C-x / (*) | ~my/comment-or-uncomment-this~ |                                  |
    |           |                              |                                  |

    - ~my/comment-or-uncomment-this~ комментирует либо линию, либо выделение - если оно существующет.

**** TODO @todo Text Editing - разобрать и раскидать по нужным разделам, или удалить если повтор

     |                 |                                                |
     |-----------------+------------------------------------------------+
     | M-del           | Delete previous word                           |
     |                 |                                                |
     |                 |                                                |
     |                 |                                                |
     | C-x C - (minus) | Decrease font size                             |
     | C-x C + (plus)  | Increase font size                             |
     | M-/             | Autocomplete word (Equivalent to VIM Ctrl + p) |
     |                 |                                                |

*** Informationm, Documentation and Help

    | Key Binding | Command (M-x command) | Description                                  |
    |-------------+-----------------------+----------------------------------------------|
    | C-h ?       | help-for-help         | Show all commands to get help on Emacs.      |
    | C-h a       | apropos               | Command Apropos                              |
    | C-h i       | info                  | Info documentation reader                    |
    |             | info-apropos          | Search for a string in emacs info pages      |
    |             | woman                 | Browser Unix man pages                       |
    |-------------+-----------------------+----------------------------------------------|
    |             |                       |                                              |
    | C-h f       | describe-function     | Describe function                            |
    | C-h v       | describe-variable     | Describe variable                            |
    | C-h m       | describe-mode         | Describe mode                                |
    | C-h s       | describe-syntax       | Describe syntax                              |
    | C-h b       | describe-bindings     | Describe key bindings for current buffer     |
    | C-h k       | describe-key          | Describe a particular key binding.           |
    |             |                       |                                              |
    |             | find-library          | Find a library *.el file loaded with require |
    |             |                       | Example: M-x find-library org                |

*** Навигация (перемещение) по тексту

    |                               |                            |                                                    |
    |-------------------------------+----------------------------+----------------------------------------------------|
    | C-a                    (*)    | my/smart-beginning-of-line | was =move-beginning-of-line= Go to start of the line |
    | C-e                           | move-end-of-line           | Go to end of the line.                             |
    | C-p [up key]                  | previous-line              |                                                    |
    | C-n [down key]                | next-line                  |                                                    |
    | M-b                           | backward-word              | Move backward one word                             |
    | M-f                           | forward-word               | Move forward one word                              |
    | M-[left key] (C-[left key])   | left-word                  | Move backward one word                             |
    | M-[right key] (C-[right key]) | right-word                 | Move forward one word                              |
    | M-g g <line-num>              | goto-line                  | Go to line number                                  |
    | M-g c <cursor-pos>            | goto-char                  | Go to character position                           |
    | M-g M-g                (*)    | my/goto-line-with-feedback |                                                    |
    |                               | previous-logical-line      |                                                    |
    |                               | next-logical-line          |                                                    |
    | M-m                    (*)    | back-to-indentation        | Go to first non whitespace in current line.        |
    |                               |                            |                                                    |

    - Из ~M-m~ (~back-to-indentation~) сделал клавишу-модификатор для работы с [[https://github.com/magnars/multiple-cursors.el][multiple-cursors]].

      | *scroll*                        |                                  |                                                    |
      |-------------------------------+----------------------------------+----------------------------------------------------|
      | C-v (next)                    | scroll-up-command                |                                                    |
      | M-v (prior)                   | scroll-down-command              |                                                    |
      | C-x < (C-next)                | scroll-left                      |                                                    |
      | C-x > (C-prior)               | scroll-right                     |                                                    |
      | C-M-S-v (M-prior, ESC prior)  | scroll-other-window-down         |                                                    |
      | C-M-v (M-next, ESC next)      | scroll-other-window              |                                                    |
      | ESC <end>                     | end-of-buffer-other-window       |                                                    |
      | ESC <begin>                   | beginning-of-buffer-other-window |                                                    |
      | M-<                           | beginning-of-buffer              | Move to top of buffer                              |
      | M->                           | end-of-buffer                    | Move to Bottom of buffer                           |
      |                               |                                  |                                                    |


**** Навигация (перемещение) по сбалансированным скобкам (moving in the parenthesis structure)

     Перемещение по скобочкам, тегам и т.д.

     |       |                                           |
     |-------+-------------------------------------------|
     | C-M-n | Move forward over a parenthetical group   |
     | C-M-p | Move backward over a parenthetical group  |
     | C-M-f | Move forward over a balanced expression   |
     | C-M-b | Move backward over a balanced expression  |
     | C-M-k | Delete s-expression under cursor          |
     |       |                                           |
     | C-M-a | Move to the beggining of current function |
     | C-M-e | Move to the end of current function       |
     |       |                                           |

**** Переход к предыдущей позиции

     [[http://xahlee.info/emacs/emacs/emacs_jump_to_previous_position.html][Emacs: Jump to Previous Position]] (ссылка на сайт Xah Lee)

     Часто вам нужно перейти на предыдущую позицию в буфере. В Emacs есть кольцо меток буфера
     (~mark ring~) и глобальное кольцо меток (~global mark ring~), которые записывают позиции меток
     и позволяют вам переходить к ним.

     Есть 2 кольца с отметками:
     - ~mark-ring~         - У каждого буфера есть своя копия.
     - ~global-mark-ring~  - Глобальный буфер.

       Чтобы отметить позицию, введите команду ~set-mark-command~ (~Ctrl-SPC~ или ~C-@~) - сделайте это
       дважды, чтобы убрать выделение. Это помещает текущую позицию в кольцо меток. Есть 3 способа
       переместить курсор в предыдущую позицию:

       |                           |                                                                                  |
       |---------------------------+----------------------------------------------------------------------------------|
       | ~Ctrl-u Ctrl-SPC~         | Переместить курсор в предыдущую отмеченную позицию в текущем буфере.             |
       |                           | Повторный вызов переместит курсор на позиции в кольце отметок.                   |
       |---------------------------+----------------------------------------------------------------------------------|
       | ~pop-global-mark~         | Переместить курсор в предыдущую отмеченную позицию (может быть в другом буфере). |
       | (~Ctrl-x Ctrl-SPC~)       | Повторный вызов переместит курсор на позиции в ~global-mark-ring~.               |
       |---------------------------+----------------------------------------------------------------------------------|
       | ~exchange-point-and-mark~ | Переместить курсор на другой конец выделения.                                    |
       | (~Ctrl-x Ctrl-x~)         | Повторный вызов любого из вышеперечисленных вернет курсор в начальную позицию.   |
       |                           |                                                                                  |

       Повторный вызов любой из вышеперечисленных команд вернёт курсор в исходное положение.
       - ~mark-ringl~;
       - ~global-mark-ring~;
       - ~pop-global-mark~.

       По умолчанию каждое кольцо меток сохраняет 16 позиций.
       При установке новой (семнадцатой) метки самая старая удаляется.
       Вы можете заставить его хранить меньше позиций для лучшего использования прыжка.

       |-------------------------------|
       | (setq mark-ring-max 6)        |
       | (setq global-mark-ring-max 6) |
       |-------------------------------|

*** Ubiquitous Emacs Key Bindings

    Some Emacs Key bindings (Emacs-style key bindings) are ubiquitous in
    Unix apps like Bash, Sh and all shells that uses the GNU readline
    library.

    | Key | Emacs                                                     | Bash Shell                               |
    |-----+-----------------------------------------------------------+------------------------------------------|
    | C-a | Move the cursor to the beggining of line                  | same                                     |
    | C-e | Move the cursor to the end of line                        | same                                     |
    |     |                                                           |                                          |
    | C-n | Move the cursor to the next line  (downward)              | Show next command in the history.        |
    | C-p | Move the cursor to the previous line (upward)             | Show the previou command in the history. |
    | C-j | New line character (same as Return)                       | same                                     |
    |     |                                                           |                                          |
    | M-b | Move the cursor backward one word                         | same                                     |
    | M-f | Move the cursor forward one word                          | same                                     |
    |     |                                                           |                                          |
    | M-t | Swap current word with previous                           | same                                     |
    |     |                                                           |                                          |
    | M-d | Delete the next word                                      | same                                     |
    |     |                                                           |                                          |
    | C-k | Delete the remaining of line from current cursor position | same                                     |
    | C-y | Paste the deleted line with (C-k) or copied line (Yank)   | same                                     |
    | M-w | Copy the slected text                                     |                                          |
    |     |                                                           |                                          |
    |     |                                                           |                                          |
    | C-r | Search forward for a string                               | Search for previous command              |
    | C-s | Search backward for a string                              | No implemented.                          |
    |     |                                                           |                                          |
    |     |                                                           |                                          |
    | c-l | Redraws the screen with the cursor in the middle.         | Clear the screen.                        |
    |     |                                                           |                                          |
    | C-_ | Undo                                                      | same                                     |
    |     |                                                           |                                          |

    See also:

    - [[http://www.catonmat.net/blog/bash-emacs-editing-mode-cheat-sheet/][Bash Emacs Editing Mode Cheat Sheet]]
    - [[http://unix.stackexchange.com/questions/150578/confusing-behavior-of-emacs-style-keybindings-in-bash][Confusing behavior of emacs-style keybindings in bash]]

** Useful Commands

   | Command                        | Key bindings | Description                                                    |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | *General*                        |              |                                                                |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | M-x kill-emacs                 | -            | Exit Emacs.                                                    |
   | M-x save-buffers-kill-terminal | C-x C-c      | Eixt Emacs and asks to save bufers.                            |
   | M-x help-with-tutorial         | C-h t        | Open Emacs built in tutorial                                   |
   | M-x suspend-emacs              |              | Suspend Emacs when in terminal or iconify in graphical mode.   |
   |                                |              |                                                                |
   | M-x suspend-frame              | C-x C-z      | Minimize frame or suspend Emacs process in terminal.           |
   |                                |              | In terminal (Unix) type fg  to return to Emacs.                |
   |                                |              |                                                                |
   | M-x quit-window                |              | Quit Emacs.                                                    |
   |                                |              |                                                                |
   | *Key bindings*                   |              |                                                                |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | global-set-key                 |              | Define a global key interactively.                             |
   | global-unset-key               |              | Unset a global key interactively.                              |
   | local-set-key                  |              | Define a key binding to current major mode.                    |
   | local-unset-key                |              | Unset a key defined locally.                                   |
   |                                |              |                                                                |
   | *Edit*                           |              |                                                                |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | M-x delete-trailing-whitespace |              | Delete trailing Whistespace and ^M characters                  |
   |                                |              | or ~\r~ from Dos or Windows.                                     |
   | M-x tabify                     |              | Converts all spaces to tab                                     |
   | M-x untabify                   |              | Converts all tabs to spaces.                                   |
   | M-x whitespace-mode            |              | Toggle white space view.                                       |
   |                                |              |                                                                |
   | *Bufferf*                        |              |                                                                |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | M-x linum-mode                 |              | Toggle line numbers                                            |
   | M-x revert-file                |              | Update buffer when file is changed externally.                 |
   | M-x auto-revert-mode           |              | Auto update the current file when its changed externally.      |
   | M-x auto-revert-tail-mode      |              | Useful to watch log files. Follows tail of file.               |
   |                                |              | Equivalent to $ tail -f [file]                                 |
   | M-x rename-buffer              |              | Rename current buffer.                                         |
   | M-x read-only                  | C-x C-q      | Toggle the current buffer read only.                           |
   | M-x auto-fill-mode             |              | Automatically format paragraphs.                               |
   |                                |              | It works like M-q, but automatically.                          |
   |                                |              |                                                                |
   | *Operating System*               |              |                                                                |
   |--------------------------------+--------------+----------------------------------------------------------------|
   | M-x shell-command              | M-!          | Run a shell command and displays the output in a buffer.       |
   |                                |              |                                                                |
   | M-x async-shell-command        | M-&          | Run asynchronous command like shells (python, ghci, scala ...) |
   |                                |              | and long running commands like ping and traceroute.            |
   |                                |              | It can launch any application without freeze Emacs.            |
   |                                |              |                                                                |
   | M-x make-directory             |              | Prompts for a directory path and creates a directory.          |
   |                                |              |                                                                |
   | M-x compile                    |              | Run a compilation command. Type g to compile again.            |
   |                                |              |                                                                |

   Notes:

   - The command auto-revert-mode is useful to edit alongside IDEs like Visual Studio or Eclipse. If
     you change the file it is automatically updated.

   - It may be better to disable C-x C-c, since it is easy to accidentally hit and exit Emacs.

** Всё, что находится далее, нужно разобрать

   - [[file:emacs_help/literate-config_without_org-babel.org][literate-config без org-babel]]
   - [[file:emacs_help/emacs-daemon.org][emacs-daemon]]
   - [[https://smartparens.readthedocs.io/en/latest/pair-management.html][Pair management]] (внешняя ссылка)
   - [[https://github.com/nilcons/emacs-use-package-fast][emacs-use-package-fast]] (внешняя ссылка) Обсуждение того, как добиться быстрой инициализации Emacs с помощью ~melpa~ и ~use-package~.

*** ПОЛЕЗНЫЕ ССЫЛКИ

    - [[https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet]["Markdown Cheatsheet" adam-p/markdown-here]]
    - [[https://caiorss.github.io/org-wiki/][org-wiki html documentation]]
    - [[https://github.com/caiorss/org-wiki][org-wiki repository]]

*** emacs org-mode

    - [[file:emacs/org-babel.org][org-babel]]
    - [[file:emacs/images.org][iimage-mode (изображения в буфере)]]
**** Ссылка в режиме org на заголовок в другом файле org

     #+BEGIN_SRC emacs-lisp

     (global-set-key (kbd "C-c l") 'org-store-link)
     (global-set-key (kbd "C-c C-l") 'org-insert-link)

     #+END_SRC

     выбираем элемент, на который нужно сделать ссылку - =org-store-link= (C-c l), затем выбираем
     место, где будет расположена ссылка - =org-insert-link= (C-c C-l), нас попросят подтвердить
     местоположение и затем ввести имя ссылки - можно просто нажать Enter, чтобы принять значения по
     умолчанию. Будет создана ссылка типа =[[file: foo.org :: * bar] [link-name]]=, которая
     отображается как link-name.

     - Более подробно о ссылках читаем [[https://orgmode.org/manual/Handling-Links.html][Handling Links]].
     - И ещё читаем [[https://orgmode.org/manual/External-Links.html#External-links][External Links]].

**** TODO @todo Изучить - [[https://harryrschwartz.com/2016/02/15/switching-to-a-literate-emacs-configuration][Switching to a Literate Emacs Configuration]] (внешняя ссылка)
**** TODO @todo Изучить - [[https://leanpub.com/lit-config/read][Literate configuration]] (внешняя ссылка)

*** Разные записи - непонятно куда их занести

    *bold*, /italic/, _underlined_, =verbatim= and ~code~, and, if you must, +strike-through+


    Вводим любой префикс, а затем =,=
    Prefix , - =describe-prefix-bindings=

*** DISABLED-COMMAND-FUNCTION - ОТКЛЮЧЕНИЕ КОМАНД →

    #+begin_SRC emacs-lisp :tangle yes

    (put 'org-mark-element 'disabled t)

    (with-eval-after-load 'org-mode
      (put 'org-mark-element 'disabled t))

    #+END_SRC

*** quelpa

    #+BEGIN_SRC emacs-lisp :tangle yes

    :init
    (unless (package-installed-p 'undo-tree)
      (quelpa '(undo-tree :fetcher url :url "http://git.savannah.gnu.org/cgit/emacs/elpa.git/plain/packages/undo-tree/undo-tree.el")))

    (unless (package-installed-p 'queue)
      (quelpa '(queue :fetcher url :url "http://git.savannah.gnu.org/cgit/emacs/elpa.git/plain/packages/queue/queue.el" :version original)))

    :quelpa (smart-mode-line :fetcher github :repo "Bruce-Connor/smart-mode-line")

    #+END_SRC

** Удобства в работе
*** Highlight

    |         |                                 | было ранее |
    |---------+---------------------------------+------------|
    | M-h h . | highlight-symbol-at-point       | M-s h .    |
    |         | highlight-lines-matching-regexp | M-s h l    |
    |         | highlight-phrase                | M-s h p    |
    |         | highlight-regexp                | M-s h r    |
    |         | unhighlight-regexp              | M-s h u    |
    |         |                                 |            |

*** Bookmarks

    |         |                                  |
    |---------+----------------------------------|
    | C-x r m | Add current buffer to bookmarks. |
    | C-x r b | Open a buffer from bookmarks.    |
    | C-x r l | List bookmarks.                  |
    |         |                                  |
    | C-x r b | helm-bookmarks                   |
    | C-x r m | bookmark-set                     |

**** TODO @todo Разобрать

     |                      |                                                                    |
     |----------------------|--------------------------------------------------------------------|
     | C-x r m RET          | Set the bookmark for the visited file, at point.                   |
     | C-x r m bookmark RET | Set the bookmark named bookmark at point (~bookmark-set~).           |
     | C-x r M bookmark RET | Like ~C-x r m~, but don't overwrite an existing bookmark.            |
     | C-x r b bookmark RET | Jump to the bookmark named bookmark (~bookmark-jump~).               |
     | C-x r l              | List all bookmarks (~list-bookmarks~).                               |
     | ~bookmark-save~        | Save all the current bookmark values in the default bookmark file. |
     |                      |                                                                    |

     ~counsel-bookmark~
     ~helm-bookmarks~
     ~bookmark-bmenu-list~

*** REGISTERS →

    |                               |                                                                                             |
    |-------------------------------+---------------------------------------------------------------------------------------------|
    | C-x r SPC (r)                 | Record the position of point and the current buffer in register r (~point-to-register~).      |
    | C-x r j (r)                   | Jump to the position and buffer saved in register r (~jump-to-register~).                     |
    | C-x r s (r)                   | Copy region into register r (~copy-to-register~).                                             |
    | C-x r i (r)                   | Insert text from register r (~insert-register~).                                              |
    | ~append-to-register~ RET (r)    | Append region to text in register r.                                                        |
    |                               | When register r contains text, you can use ~C-x r +~ (~increment-register~)                     |
    |                               | to append to that register.                                                                 |
    |                               | Note that command ~C-x r +~ behaves differently if r contains a number.                       |
    | ~prepend-to-register~ RET (r)   | Prepend region to text in register r.                                                       |
    | C-x r r (r)                   | Copy the region-rectangle into register r (~copy-rectangle-to-register~).                     |
    |                               | With prefix argument, delete it as well.                                                    |
    | C-x r i (r)                   | Insert the rectangle stored in register r (if it contains a rectangle) (~insert-register~).   |
    | C-u number C-x r n (r)        | Store number into register r (~number-to-register~).                                          |
    | C-u number C-x r + (r)        | If r contains a number, increment the number in that register by number.                    |
    |                               | Note that command ~C-x r +~ (~increment-register~) behaves differently if r contains text.      |
    | C-x r i (r)                   | Insert the number from register r into the buffer.                                          |
    | C-x r f (r)                   | Copy the frame configuration into register r.                                               |
    |                               |                                                                                             |

    ~helm-register~
    ~counsel-register~
    ~kmacro-to-register~ (~C-x C-k x~)


    (~C-x r j~)
    (set-register ?i '(file . "~/.emacs.d/init.el"))
    (set-register ?g '(file . "~/.gitconfig"))
    (set-register ?p '(file . "/etc/portage/"))

*** ABBREV (ABBREVIATIONS) →

    |       |                    |
    |-------+--------------------+
    | M-/   | dabbrev-expand     |
    | C-M-/ | dabbrev-completion |
    |       |                    |

*** Keyboard Macros

    | Key Binding | M-x <cmd>                 |   |
    |-------------+---------------------------+---|
    | C-x (       | kmacro-start-macro        |   |
    | C-x )       | kmacro-end-macro          |   |
    | C-x e or f4 | kmacro-end-and-call-macro |   |
    |             |                           |   |

*** Сужение текста (narrowing)

    | Key Binding | M-x <cmd>               | Description                      |
    |-------------+-------------------------+----------------------------------|
    | C-x n w     | widen                   | Back to full buffer              |
    | C-x n p     | narrow-to-page          |                                  |
    | C-x n n     | narrow-to-region        | Narrow to selected text (region) |
    | C-x n d     | narrow-to-defun         | Narrow to an s-expression        |
    | C-x n i (*) | my/narrow-next-line     |                                  |
    | C-x n - (*) | my/narrow-or-widen-dwim |                                  |
    |             | sp-narrow-to-sexp       |                                  |
    |             |                         |                                  |

    - ~C-x n i~ (~my/narrow-next-line~) позволяет сузить область видимости до строки, на которой
      находится курсор.
    - ~C-x n -~ (~my/narrow-or-widen-dwim~) сужает область и наоборот показывает, если она сужена.

      Этот набор команд позволяет редактировать ограниченную область буфера.

      *Примечания:* эти привязки клавиш переопределяются режимом ~cua~, и ~C-x~ вырезает выделенный текст в
      этом режиме. Если клавиши переопределены, необходимо использовать команду ~M-x <command>~ или
      команды, назначенные новой привязке клавиш.

*** Dired

    Dired mode provides a file manager in Emacs and it allows to browser
    directories, open files, apply operations like copy, move, rename on
    multiple files and apply shell commands on files. It can be invoked
    with _C-x d_ or _M-x dired_.


**** Запуск dired

     |           | стало нынче             | было ранее         |   |
     |-----------+-------------------------+--------------------+---|
     |           |                         |                    |   |
     | C-x d     | counsel-dired           | dired              |   |
     | C-x 4 d   |                         | dired-other-window |   |
     | C-x 5 d   |                         | dired-other-frame  |   |
     | C-d t d   | my/sudired              |                    |   |
     | C-x C-j   | dired-jump              |                    |   |
     | C-x 4 C-j | dired-jump-other-window |                    |   |
     |           |                         |                    |   |



     | Key binding | Command                 | Description                                             |
     |-------------+-------------------------+---------------------------------------------------------|
     |             |                         |                                                         |
     |             | M-x find-dired          | Find all files in directory matching a pattern.         |
     |             | M-x dired-omit-files    | Omit garbage or unimportant files                       |
     |-------------+-------------------------+---------------------------------------------------------|
     | f           |                         | Open file at point in current window                    |
     | o           |                         | Open file at point in another window                    |
     | +           | dired-create-directory  | Create a directory                                      |
     | (           | dired-hide-details-mode | Toggle hide/show details                                |
     |             |                         |                                                         |
     | C-x C-q     |                         | Makes the dired buffer editable. When finishing         |
     |             |                         | changing files enter C-c C-c                            |
     |             |                         |                                                         |
     |-------------+-------------------------+---------------------------------------------------------|
     | w           |                         | Copy file name without directory                        |
     | C-0 w       |                         | Copy file name with full path                           |
     | m           |                         | Mark file or directory in dired mode                    |
     | u           |                         | Unmark file                                             |
     | t           |                         | Mark/Unmark all files                                   |
     |             |                         |                                                         |
     | X or !      | dired-o-shell-command   | Apply shell command to file at point. It can be used to |
     |             |                         | extract archives like *.tar, *.zip                      |
     |             |                         |                                                         |
     | M-!         |                         | Apply shell command to marked files (selected with m)   |
     |             |                         |                                                         |
     | &           |                         | Run async shell command on file at point                |
     |             |                         | or apply shell command to a list of files               |
     |-------------+-------------------------+---------------------------------------------------------|
     | s           |                         | Change the sorting order of the directory               |
     | D           |                         | Delete file                                             |
     | g           |                         | Update dired buffer if directory has changed            |
     | R           |                         | Rename file                                             |
     | %R          |                         | Rename with regex                                       |
     | y           |                         | Show file type                                          |
     |             |                         |                                                         |
     |-------------+-------------------------+---------------------------------------------------------|
     | q           |                         | Kill dired buffer.                                      |
     | m           | dired-mark              | Mark current file                                       |
     | u           | dired-unmark            | Unmark current file.                                    |
     | U           | dired-unmark-all-marks  | Remove all marks from all files.                        |
     | g           | revert-buffer           | Revert dired buffer (updates it).                       |
     |             | auto-revert-mode        | Auto update dired buffer.                               |
     |             |                         |                                                         |

**** Команды в буфере dired

     |             |                                           |         |        |
     |-------------|-------------------------------------------|---------|--------|
     | m           | dired-mark                                |         |        |
     | %m          | dired-mark-files-regexp (mark by pattern) |         |        |
     | %g          | dired-mark-files-containing-regexp        |         |        |
     | d           | dired-flag-file-deletion                  |         |        |
     | % d         | dired-flag-files-regexp (for delete)      |         |        |
     | % u         | dired-upcase (rename upcase)              |         |        |
     | % l         | dired-downcase (rename downcase)          |         |        |
     | % R         | dired-do-rename-regexp                    |         |        |
     | % r         | dired-do-rename-regexp                    |         |        |
     | % C         | dired-do-copy-regexp                      |         |        |
     | % H         | dired-do-hardlink-regexp                  |         |        |
     | % S         | dired-do-symlink-regexp                   |         |        |
     | =           | diredp-ediff                              |         |        |
     | u           | dired-unmark                              |         |        |
     | U           | dired-unmark-all-marks                    |         |        |
     | x           | dired-do-flagged-delete (delete marked)   |         |        |
     | C           | dired-do-copy                             |         |        |
     | R           | dired-do-rename                           |         |        |
     | r           | diredp-rename-this-file                   |         |        |
     | D           | dired-do-delete                           |         |        |
     | Z           | dired-do-compress                         |         |        |
     | c           | dired-do-compress-to                      |         |        |
     | +           | dired-create-directory                    |         |        |
     | g           | revert-buffer (refresh dir listing)       |         |        |
     | M-q         | dired-do-query-replace-regexp             |         |        |
     | i           | dired-maybe-insert-subdir                 |         |        |
     | K           | dired-kill-subdir                         |         |        |
     | ^           | my/dired-go-up-dir                        |         |        |
     | q           | quit-window                               |         |        |
     |             |                                           |         |        |
     |             |                                           |         |        |
     | e (C-x C-q) | wdired-change-to-wdired-mode              | C-c C-c | commit |
     |             |                                           | C-c C-k | abort  |
     |             |                                           |         |        |
     | / /         | dired-narrow                              |         |        |
     | / f         | dired-narrow-fuzzy                        |         |        |
     | / r         | dired-narrow-regexp                       |         |        |
     |             |                                           |         |        |
     | s           | xah-dired-sort                            |         |        |
     | M-o         | xah-open-in-external-app                  |         |        |
     | M-e         | my/open-window-manager                    |         |        |
     |             |                                           |         |        |
     | k           | dired-do-kill-lines                       |         |        |
     | M-k         | dired-kill-line                           |         |        |
     | C-d M-o     | my/dired-start-process                    |         |        |
     |             |                                           |         |        |
     | C-d <right> | dired-subtree-toggle                      |         |        |
     | <f5>        | dired-subtree-revert                      |         |        |
     |             |                                           |         |        |
     | C-d R       | dired-rsync                               |         |        |
     |             |                                           |         |        |
     | P           | peep-dired                                |         |        |
     |             |                                           |         |        |
